Developing
==========

Visual Studio Code
------------------

Make sure you have ``opam`` installed. If you don't have it, it is probably
best to follow the `Real World OCaml Installation Instructions <https://dev.realworldocaml.org/install.html>`_.

The following is all you need to get Visual Studio Code working ...

.. code-block:: bash

    opam install utop dune ocaml-lsp-server ocamlformat

Building Code
-------------

The full build for ocaml 4.08.0 and 4.12.0 is:

.. code-block:: bash

    opam install dune
    opam install ppx_deriving_protobuf
    opam install pcre menhirLib                     # proscript-messaging runtime dependencies
    opam install ulex camlp4 ocamlformat            # proscript-messaging compile-time auto-translation
    opam install alcotest ppx_inline_test           # test support
    opam install cstruct                            # dirsp-proscript dependencies
    opam install mirage-crypto-rng mirage-crypto-ec # dirsp-proscript-mirage dependencies
    opam install iter                               # dirsp-proscript-mirage test dependencies
    eval $(opam env)
    make

-or- if you want a build for your current ocaml installation (ex. ocaml 4.08.0) that re-uses the autogenerated OCaml code that
is already part of this source tree, do:

.. code-block:: bash

    opam install dune pcre menhirLib alcotest ppx_inline_test cstruct mirage-crypto-rng mirage-crypto-ec iter
    eval $(opam env)
    make build-noautogen

In either case, after building you may install the package locally:

.. code-block:: bash

    opam install .

Building Documentation
----------------------

You will need Python on your machine to build parts of the documentation; Python 3.8 is the only version that has been tested.

Configure Python like so:

.. code-block:: bash

    pip install pygments sphinx sphinx-rtd-theme rstcheck

and OCaml like so:

.. code-block:: bash

    opam install odoc

Then you can build the documentation with:

.. code-block:: bash

    make doc

You can view the reStructuredText documentation with:

.. code-block:: bash

    open _build/html/index.html    # Most Linux distributions support "open"-ing a file in a web browser from the command line
    wslview _build/html/index.html # or the equivalent command in Windows Subsystem for Linux

and the OCaml documentation with:

.. code-block:: bash

    open _build/default/_doc/_html/index.html    # Linux
    wslview _build/default/_doc/_html/index.html # WSL
